<!DOCTYPE html>
<html lang="it">
<head>

<link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<title>Parcheggi Matrimonio</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- PapaParse -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { font-family: 'Kaushan Script', sans-serif; margin: 0; }
h1 { padding: 10px; }
#map { height: 400px; margin: 10px; border-radius: 8px; }

table { width: 100%; border-collapse: collapse; margin: 10px; font-size: 14px; background-color: #f4cccc; table-layout: fixed; }  /* Aggiunto per gestire larghezza fissa colonne */
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
th {
  background-color: #e6a9a9; /* pi√π scuro di #f4cccc */
  /*background-color: #dd8f8f;*/
  color: #000;
}
tr:hover { background: #fafafa; }
th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: left;
  word-wrap: break-word; /* Permette al testo lungo di andare a capo */
  white-space: normal;
}

.table-wrapper {
  width: 95%;
  max-width: 1200px;
  margin: 10px auto;
  overflow-x: auto;
}

#map {
  width: 100%;      /* occupa tutta la larghezza del contenitore */
  height: 400px;    /* altezza fissa */
  border-radius: 8px;
  margin-bottom: 10px;
}


/* Larghezza percentuale colonne */
th:nth-child(1), td:nth-child(1) { width: 6%; }   /* # */
th:nth-child(2), td:nth-child(2) { width: 22%; }  /* Parcheggio */
th:nth-child(3), td:nth-child(3) { width: 28%; }  /* Indirizzo */
th:nth-child(4), td:nth-child(4) { width: 8%; }   /* Posti */
th:nth-child(5), td:nth-child(5) { width: 10%; }  /* Accessibilit√† */
th:nth-child(6), td:nth-child(6) { width: 8%; }   /* Distanza */
th:nth-child(7), td:nth-child(7) { width: 10%; }  /* Percorso */
th:nth-child(8), td:nth-child(8) { width: 8%; }   /* Dislivello */

/* Colonne allineate al centro */
th:nth-child(1), td:nth-child(1),   /* # */
th:nth-child(4), td:nth-child(4),   /* Posti */
th:nth-child(5), td:nth-child(5),   /* Accessibilit√† */
th:nth-child(6), td:nth-child(6),   /* Distanza */
th:nth-child(7), td:nth-child(7),   /* Percorso */
th:nth-child(8), td:nth-child(8) {  /* Dislivello */
  text-align: center;
}

/* Colonne allineate a sinistra */
th:nth-child(2), td:nth-child(2),   /* Parcheggio */
th:nth-child(3), td:nth-child(3) {  /* Indirizzo */
  text-align: left;
}

.marker-number div {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #1976d2;
  color: white;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-weight: bold;
  border: 2px solid white;
}

/* Link blu e hover */
a {
  color: #1976d2;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
</style>
</head>
<body>

<!--<h1>Parcheggi Matrimonio</h1>-->


<div class="table-wrapper">
  <div id="map"></div>  
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Parcheggio (con link)</th>
        <th>Indirizzo</th>
        <th>Posti</th>
        <th>Accessibilit√†</th>
        <th>Distanza (m)</th>
        <th>Lunghezza percorso (m)</th>
        <th>Dislivello (m)</th>
      </tr>
    </thead>
    <tbody id="tabella"></tbody>
  </table>
</div>

<script>
const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoiq8woGXo_hibNIDK3gsBSR56zgU4FEvPP0-lmdfv24Bt_l0hz6Jyh0jCsG8W_pKYsB2JKEGzaURo/pub?output=csv";
const CENTRO = { lat: 44.14919, lon: 12.13341 };

// Inizializza mappa
const map = L.map('map').setView([CENTRO.lat, CENTRO.lon], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);
const municipioIcon = L.divIcon({
  className: 'marker-number',
  html: `<div style="background:#8e24aa">üèõÔ∏è</div>`,
  iconSize: [28, 28],
  iconAnchor: [14, 28]
});

L.marker([CENTRO.lat, CENTRO.lon], { icon: municipioIcon })
  .addTo(map)
  .bindPopup("<b>Municipio</b>")
  .openPopup();


// Carica CSV con PapaParse
Papa.parse(csvURL, {
  download: true,
  header: true,
  skipEmptyLines: true,
  dynamicTyping: false,
  trimHeaders: true,
  transform: value => value.trim(),
  complete: function(results) {
  const dati = results.data
    .map(p => {
      const lat = parseFloat(p.Latitudine);
      const lon = parseFloat(p.Longitudine);
      if (isNaN(lat) || isNaN(lon)) return null;
      return {
        label: p.Descrizione || "Parcheggio",
        lat,
        lon,
        indirizzo: p.Indirizzo || "-",
        posti: p.Posti || "-",
        accessibilita: p.Accessibilit√† || "-",
        distanza: p["Distanza in linea d'aria"] || "-",
        percorso: p["Lunghezza del percorso"] || "-",
        dislivello: p.Dislivello || "-"
      };
    })
    .filter(Boolean);

    // Ordina per distanza crescente
    //dati.sort((a, b) => parseFloat(a['Distanza in linea d\'aria'] || 0) - parseFloat(b['Distanza in linea d\'aria'] || 0));

    let html = "";
    dati.forEach((p, index) => {
      // Marker numerato
      L.marker([p.lat, p.lon], {
        icon: L.divIcon({
          className: 'marker-number',
          html: `<div>P${String(index + 1).padStart(2,'0')}</div>`,
          iconSize: [28, 28],
          iconAnchor: [14, 28]
        })
      }).addTo(map).bindPopup(`
          <b>${p.label}</b><br>
          ${p.indirizzo}<br>
          Posti: ${p.posti}<br>
          Accessibilit√†: ${p.accessibilita}<br>
          Distanza: ${p.distanza} m<br>
          Percorso: ${p.percorso} m<br>
          Dislivello: ${p.dislivello} m
        `);

      // Riga tabella
        html += `
          <tr>
            <td>P${String(index + 1).padStart(2,'0')}</td>
            <td>
              <a href="https://www.google.com/maps/search/?api=1&query=${p.lat},${p.lon}"
                target="_blank">
                ${p.label}
              </a>
            </td>
            <td>${p.indirizzo}</td>
            <td>${p.posti}</td>
            <td>${p.accessibilita}</td>
            <td>${p.distanza}</td>
            <td>${p.percorso}</td>
            <td>${p.dislivello}</td>
          </tr>
        `;
    });

    document.getElementById("tabella").innerHTML = html;
  },
  error: function(err) {
    console.error("Errore CSV:", err);
  }
});
</script>

</body>
</html>
