<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Mappa Parcheggi e Luoghi</title>

<!-- Font Kaushan Script -->
<link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- PapaParse -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { font-family: 'Kaushan Script', sans-serif; margin: 0; }
#map { height: 100vh; width: 95%; max-width: 1200px; margin: auto; border-radius: 8px; }

/* Marker numerati parcheggi */
.marker-number div {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #1976d2;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  font-weight: bold;
  border: 2px solid white;
  font-family: 'Kaushan Script', cursive;
  font-size: 16px;
}

/* Marker speciali */
.marker-special div {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #d81b60;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  border: 2px solid white;
  font-size: 18px;
}

/* Marker Municipio */
.marker-municipio div {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #8e24aa;
  color: white;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  border: 2px solid white;
  font-size: 18px;
}

a { color: #1976d2; text-decoration: none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div id="map"></div>

<script>
const CENTRO = { lat: 44.14919, lon: 12.13341 };
const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoiq8woGXo_hibNIDK3gsBSR56zgU4FEvPP0-lmdfv24Bt_l0hz6Jyh0jCsG8W_pKYsB2JKEGzaURo/pub?output=csv";

// Inizializza mappa
const map = L.map('map').setView([CENTRO.lat, CENTRO.lon], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

// Funzioni per creare icone
function createNumberIcon(text) {
  return L.divIcon({
    className: 'marker-number',
    html: `<div>${text}</div>`,
    iconSize: [32, 32],
    iconAnchor: [16, 32]
  });
}

function createSpecialIcon(symbol) {
  return L.divIcon({
    className: 'marker-special',
    html: `<div>${symbol}</div>`,
    iconSize: [32, 32],
    iconAnchor: [16, 32]
  });
}

function createMunicipioIcon() {
  return L.divIcon({
    className: 'marker-municipio',
    html: `<div>üèõÔ∏è</div>`,
    iconSize: [32, 32],
    iconAnchor: [16, 32]
  });
}

// Aggiungi Municipio
L.marker([CENTRO.lat, CENTRO.lon], { icon: createMunicipioIcon() }).addTo(map);

// Aggiungi punti speciali
const specialPoints = [
  {lat: 44.14268, lon: 12.09886, label: "Casa degli Sposi", symbol: "‚ù§Ô∏è"},
  {lat: 44.14925, lon: 12.13385, label: "Enoteca Colonna Panorama", symbol: "ü•Ç"},
  {lat: 44.15848, lon: 12.18447, label: "Agriturismo Al Colle", symbol: "üç¥"}
];

specialPoints.forEach(p => {
  L.marker([p.lat, p.lon], { icon: createSpecialIcon(p.symbol) })
    .addTo(map)
    .bindPopup(`
      <b>${p.label}</b><br>
      <a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lon}" target="_blank">
        Naviga a qui
      </a>
    `);
});

// Carica parcheggi da Google Sheet
Papa.parse(csvURL, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results) {
    const dati = results.data
      .map((p, index) => {
        const lat = parseFloat(p.Latitudine);
        const lon = parseFloat(p.Longitudine);
        if (isNaN(lat) || isNaN(lon)) return null;
        return {
          label: p.Descrizione || "Parcheggio",
          indirizzo: p.Indirizzo || "-",
          posti: p.Posti || "-",
          accessibilita: p.Accessibilit√† || "-",
          distanza: p["Distanza in linea d'aria"] || "-",
          percorso: p["Lunghezza del percorso"] || "-",
          dislivello: p.Dislivello || "-",
          lat, lon
        };
      }).filter(Boolean);

    dati.forEach((p, index) => {
      L.marker([p.lat, p.lon], { icon: createNumberIcon(`P${String(index+1).padStart(2,'0')}`) })
        .addTo(map)
        .bindPopup(`
          <b>${p.label}</b><br>
          ${p.indirizzo}<br>
          Posti: ${p.posti}<br>
          Accessibilit√†: ${p.accessibilita}<br>
          Distanza: ${p.distanza} m<br>
          Percorso: ${p.percorso} m<br>
          Dislivello: ${p.dislivello} m<br>
          <a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lon}" target="_blank">
            Naviga a qui
          </a>
        `);
    });
  }
});
</script>

</body>
</html>
